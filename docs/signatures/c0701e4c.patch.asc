-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA256

- From c0701e4c2799d335be179538e995f3dd7ba4b0e9 Mon Sep 17 00:00:00 2001
From: Sebastian Bach <sebtomba@gmail.com>
Date: Tue, 30 May 2023 14:10:07 +0200
Subject: [PATCH] [PM-6226] Clean-up dependencies

- ---
 Cargo.lock                          | 21 +++------------------
 ledger/Cargo.toml                   |  9 ++++++++-
 {node => ledger}/src/generate_tx.rs | 10 +++++-----
 ledger/src/lib.rs                   |  1 +
 node/Cargo.toml                     | 11 +----------
 node/src/lib.rs                     |  1 -
 pallets/midnight/Cargo.toml         |  9 ---------
 runtime/Cargo.toml                  |  1 -
 8 files changed, 18 insertions(+), 45 deletions(-)
 rename {node => ledger}/src/generate_tx.rs (98%)

diff --git a/Cargo.lock b/Cargo.lock
index cc0ff330..4025d17e 100644
- --- a/Cargo.lock
+++ b/Cargo.lock
@@ -2876,10 +2876,8 @@ source = "registry+https://github.com/rust-lang/crates.io-index"
 checksum = "c85e1d9ab2eadba7e5040d4e09cbd6d072b76a557ad64e797c2cb9d4da21d7e4"
 dependencies = [
  "cfg-if",
- - "js-sys",
  "libc",
  "wasi 0.11.0+wasi-snapshot-preview1",
- - "wasm-bindgen",
 ]
 
 [[package]]
@@ -4544,11 +4542,13 @@ name = "midnight-ledger"
 version = "0.1.0"
 dependencies = [
  "ciborium",
- - "hex",
+ "futures",
  "midnight-base-crypto",
  "midnight-coin-structure",
  "midnight-lares-compitales",
  "midnight-ledger 2.0.0-pre-0.1",
+ "midnight-storage",
+ "rand 0.8.5",
  "serde",
  "serde_json",
 ]
@@ -4576,24 +4576,17 @@ dependencies = [
 name = "midnight-node"
 version = "4.0.0-dev"
 dependencies = [
- - "ciborium",
  "clap",
  "cranelift-codegen 0.91.1",
  "frame-benchmarking",
  "frame-benchmarking-cli",
  "frame-system",
- - "futures",
  "hex",
  "jsonrpsee",
- - "midnight-base-crypto",
- - "midnight-lares-compitales",
  "midnight-ledger 0.1.0",
- - "midnight-ledger 2.0.0-pre-0.1",
  "midnight-node-runtime",
- - "midnight-storage",
  "pallet-transaction-payment",
  "pallet-transaction-payment-rpc",
- - "rand 0.8.5",
  "sc-basic-authorship",
  "sc-cli",
  "sc-client-api",
@@ -5256,21 +5249,13 @@ dependencies = [
 name = "pallet-midnight"
 version = "4.0.0-dev"
 dependencies = [
- - "ciborium",
  "frame-benchmarking",
  "frame-support",
  "frame-system",
- - "getrandom 0.2.9",
- - "hex",
  "log",
- - "midnight-base-crypto",
- - "midnight-coin-structure",
- - "midnight-lares-compitales",
  "midnight-ledger 0.1.0",
- - "midnight-ledger 2.0.0-pre-0.1",
  "parity-scale-codec",
  "scale-info",
- - "serde_json",
  "sp-core",
  "sp-io",
  "sp-runtime",
diff --git a/ledger/Cargo.toml b/ledger/Cargo.toml
index 740bac5f..4406c307 100644
- --- a/ledger/Cargo.toml
+++ b/ledger/Cargo.toml
@@ -12,4 +12,11 @@ coin-structure = { git = "https://github.com/input-output-hk/midnight-foundation
 ciborium = { version = "0.2.0" }
 serde = { version = "^1.0.0", features = ["derive", "rc"] }
 serde_json = { version = "1.0" }
- -hex = { version = "0.4.3" }
+
+futures = { version = "0.3.21", features = ["thread-pool"], optional = true }
+rand = { version = "^0.8.4", features = ["getrandom"], optional = true }
+ledger-storage = { git = "https://github.com/input-output-hk/midnight-foundations", package = "midnight-storage", features = ["fake"], optional = true }
+
+
+[features]
+generate_tx = ["dep:futures", "dep:rand", "dep:ledger-storage"]
diff --git a/node/src/generate_tx.rs b/ledger/src/generate_tx.rs
similarity index 98%
rename from node/src/generate_tx.rs
rename to ledger/src/generate_tx.rs
index a1b57a35..467a1104 100644
- --- a/node/src/generate_tx.rs
+++ b/ledger/src/generate_tx.rs
@@ -1,4 +1,4 @@
- -#[cfg(test)]
+#[cfg(all(test, feature = "generate_tx"))]
 mod generate_tx {
 	use std::{fs::File, io, iter::empty, path::PathBuf};
 
@@ -9,10 +9,6 @@ mod generate_tx {
 		queries::{QueryArgs, QueryType},
 		state::{ContractOperation, ContractState},
 	};
- -	use ledger::{
- -		construct::TransactionBuilder,
- -		structure::{LedgerState, Transaction},
- -	};
 	use ledger_storage::{Map, Set};
 	use midnight_base_crypto::{
 		field::FieldRepr,
@@ -20,6 +16,10 @@ mod generate_tx {
 		proofs::{IrSource, KeyLocation, Proof, ProverKey, VerifierKey},
 		rng::SplittableRng,
 	};
+	use mn_ledger::{
+		construct::TransactionBuilder,
+		structure::{LedgerState, Transaction},
+	};
 	use rand::{rngs::StdRng, SeedableRng};
 	use serde_json::{from_str, to_string};
 
diff --git a/ledger/src/lib.rs b/ledger/src/lib.rs
index 42460863..86f484b0 100644
- --- a/ledger/src/lib.rs
+++ b/ledger/src/lib.rs
@@ -1,3 +1,4 @@
+mod generate_tx;
 pub mod ledger;
 pub mod transaction;
 
diff --git a/node/Cargo.toml b/node/Cargo.toml
index 330c3a0c..88e4f849 100644
- --- a/node/Cargo.toml
+++ b/node/Cargo.toml
@@ -17,19 +17,10 @@ targets = ["x86_64-unknown-linux-gnu"]
 name = "midnight-node"
 
 [dependencies]
+midnight-ledger = { version = "0.1.0", path = "../ledger" }
 clap = { version = "4.0.9", features = ["derive"] }
- -futures = { version = "0.3.21", features = ["thread-pool"] }
- -
 hex = "0.4.3"
 
- -midnight-ledger = { version = "0.1.0", path = "../ledger" }
- -
- -ledger = { git = "https://github.com/input-output-hk/midnight-ledger-prototype", package = "midnight-ledger", features = ["transaction-construction", "proving"] }
- -lares-compitales = { git = "https://github.com/input-output-hk/abcirdc", package = "midnight-lares-compitales" }
- -ledger-storage = { git = "https://github.com/input-output-hk/midnight-foundations", package = "midnight-storage", features = ["fake"] }
- -rand = { version = "^0.8.4", features = ["getrandom"] }
- -midnight-base-crypto = { git = "https://github.com/input-output-hk/midnight-foundations", package = "midnight-base-crypto", features = ["fake"] }
- -ciborium = { version = "0.2.0" }
 serde_json = { version = "1.0" }
 serde = { version = "^1.0.0", features = ["derive", "rc"] }
 
diff --git a/node/src/lib.rs b/node/src/lib.rs
index 7c385f5b..cf5e7fec 100644
- --- a/node/src/lib.rs
+++ b/node/src/lib.rs
@@ -1,5 +1,4 @@
 pub mod chain_spec;
- -mod generate_tx;
 pub mod midnightrpc;
 pub mod rpc;
 pub mod service;
diff --git a/pallets/midnight/Cargo.toml b/pallets/midnight/Cargo.toml
index 6c48c65b..3bf24cd7 100644
- --- a/pallets/midnight/Cargo.toml
+++ b/pallets/midnight/Cargo.toml
@@ -18,16 +18,10 @@ codec = { package = "parity-scale-codec", version = "3.0.0", default-features =
 	"derive",
 ] }
 
- -ledger = { git = "https://github.com/input-output-hk/midnight-ledger-prototype", package = "midnight-ledger", features = ["transaction-construction", "proving"] }
- -lares-compitales = { git = "https://github.com/input-output-hk/abcirdc", package = "midnight-lares-compitales" }
- -midnight-base-crypto = { git = "https://github.com/input-output-hk/midnight-foundations", package = "midnight-base-crypto", features = ["fake"] }
- -coin-structure = { git = "https://github.com/input-output-hk/midnight-foundations", package = "midnight-coin-structure", features = ["fake"] }
 midnight-ledger = { version = "0.1.0", path = "../../ledger" }
 
- -hex = { version = "0.4.3" }
 log = { version = "0.4.17" }
 
- -getrandom = { version = "0.2.8", features = ["js"] }
 sp-io = { version = "7.0.0", default-features = false, git = "https://github.com/paritytech/substrate.git", branch = "polkadot-v0.9.37" }
 
 scale-info = { version = "2.1.1", default-features = false, features = ["derive"] }
@@ -35,9 +29,6 @@ frame-benchmarking = { version = "4.0.0-dev", default-features = false, optional
 frame-support = { version = "4.0.0-dev", default-features = false, git = "https://github.com/paritytech/substrate.git", branch = "polkadot-v0.9.37" }
 frame-system = { version = "4.0.0-dev", default-features = false, git = "https://github.com/paritytech/substrate.git", branch = "polkadot-v0.9.37" }
 
- -ciborium = { version = "0.2.0" }
- -serde_json = { version = "1.0" }
- -
 [dev-dependencies]
 sp-core = { version = "7.0.0", default-features = false, git = "https://github.com/paritytech/substrate.git", branch = "polkadot-v0.9.37" }
 sp-io = { version = "7.0.0", default-features = false, git = "https://github.com/paritytech/substrate.git", branch = "polkadot-v0.9.37", features = ["std"] }
diff --git a/runtime/Cargo.toml b/runtime/Cargo.toml
index a63e7840..56003294 100644
- --- a/runtime/Cargo.toml
+++ b/runtime/Cargo.toml
@@ -54,7 +54,6 @@ frame-system-benchmarking = { version = "4.0.0-dev", default-features = false, g
 serde = { version = "^1.0.0", features = ["derive", "rc"] }
 serde_json = { version = "1.0" }
 
- -# todo transitive dependency on ledger
 # Local Dependencies
 pallet-midnight = { version = "4.0.0-dev", default-features = false, path = "../pallets/midnight" }
 
- -- 
2.46.0

-----BEGIN PGP SIGNATURE-----

iQIzBAEBCAAdFiEE9Oz16eF+Nv5C7TpSdEmbFI1hGmwFAmhtArIACgkQdEmbFI1h
Gmxt6A//bQoLPOeGUT2KrViee7mLkCeiitU6bzo7egfuUxvz0CMs/zCsh59Qafww
NoQxDhpRwGSiUXR8dGgEw/ss/dW4UBTg2TmFn55wNln7o8FabbodwUbXD0bu1zO9
7x7QWXqOaPcP82KKTJuIwi90xOaiRKyukkH0G2CR2ktpZDf2ocYIwbi/m3y5ilPi
XDpLqw0tTPuFQJyedvUz4ItLsiJeg7xvMgbah4i4j/+49whFa4vQRlOfYi9bOsik
I6usxCuYcbDFaIuVHlVbZbjZYS1xZAinuOR+e3ZooUfTJEihM486NpmUm/Hrb9My
bJSFJ24HrEbT7bEAfhaeJcMm1vNM8U6ZhS3RAW0AmshB9+axz3jo8AqcgTjfieLp
TA0u2K+S4AymBtxqdO0G+8ma+jUqD/TiGI6oOJH638OGFjb/FVvTaAvTDtd90LK/
AURdUcfWGd22pkYsJ6Aky3mRMVq4R14QOdIpjgUGoU6vbRC2bA8p9DnjnoRwlmhx
weFX3175ISXrjbOdPDuJ63MiCKAbGPpymT/6JS/S0w495mKYkK6TJOPDPWcdOlyU
aBsYm0JZr4HgXibeaVxtxVxmE0xkK6UKwzVQMIdP9W02mZZiplZzh+jxPLSteUFI
k4P+p4LSkP0rAiyMSPxfmxb07nNFqyTu5fMsABvQUthlaCCVYmY=
=T6z7
-----END PGP SIGNATURE-----
